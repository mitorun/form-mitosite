<!doctype html><!-- Файл form.html -->
<html lang="ru">
<head>
	<meta name="robots" content="noindex, nofollow">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<meta charset="utf-8">
	<title>Формы связи – Компоненты Mitorun Studio</title>
	<meta name="description" content="Описание компонента">
	<meta name="author" content="Oleg Mitorun">

	<!--<link rel="stylesheet" href="form.css">-->
	<meta name="theme-color" content="#d4e6f7">
	<link rel="icon" type="image/svg+xml" sizes="any" href="img/favicon.svg">

	<style>
body {
	font: 400 20px sans-serif;
}
.container {
	padding-left: max(calc(50% - 900px / 2), var(--container-padding, 14px));
	padding-right: max(calc(50% - 900px / 2), var(--container-padding, 14px));
}
	</style>
</head>


<body>


	<main class="container">

		<h1>Компонент формы связи</h1>
		<br><hr><br>
		<a href="form.html">Форма - описание работы форм.</a><br>
		<a href="form-1.html">Форма-1 без JS (работает только на PHP).</a><br>
		<a href="form-2.html">Форма-2 с JS.</a><br>
		<a href="form-3.html">Форма-3 ???.</a><br>
		<a href="https://github.com/mitorun/mitosite-form">Файлы PHP на гитхабе.</a><br>
		<a href="https://github.com/PHPMailer/PHPMailer">https://github.com/PHPMailer/PHPMailer</a><br>
		<br><hr><br>


		<h2>Требования к PHP-файлу</h2>

		<p>PHP-файл с настройками (обработчик) должен быть один универсальный для всех вариантов отправки сообщений на почту. Он должен поддерживать любые варианты инпутов: текстовые, чекбоксы, радио, селекты, рейнджи и отправку файлов.</p>
		<p>Единственные места где нужно вносить изменения для нового проекта - это емейл отправителя, пароль отправителя, емейл получателя и заголовки-подписи для писем.</p>
		<p>Письма должны отправляться самым лучшим и надежным способом. Насколько знаю это SMTP с указанием емейла отправителя + пароль для приложений к нему. Желательно чтобы емейл отправителя и получателя был олдин и тот же.</p>
		<p>После отправки сообщения нужно чтобы пользователя не перекидывало со страницы с формой, чтобы эта страница не перезагружалась, чтобы JS-скрипт открывал сообщения об успешной или неуспешной отправке. А если скрипта нету, то в идеале добиться максимально похожего поведения с помощью только PHP-скрипта.</p>
		<p>Для отправки файлов вероятно стоит добавить грубую валидацию, чтобы пользователи не могли переслать откровенно огромные или опасные файлы. Для этого ограничить размер вложения 200 Мб и форматы файлов (например указать разрешенные).</p>
		<br><hr><br>




		<h2>Требования к управляющему JS-скрипту</h2>
		<p>Модульность: чтобы каждую отдельную функцию можно было просто удалить или наоборот добавить (например код инпута-ловушки, код маски или валидации) и при этом скрипт продолжал работать с остальными функциями.</p>
		<p>Форма должна работать без перезагрузки страницы, оставаться на этой странице, введенная информация не должна удаляться или мигать пока форма успешно не отправится.</p>
		<p>После отправки формы скрипт должен показать сообщение об успешной или неудачной отправке. Форма должна очиститься.</p>
		<p>Работа нескольких форм на странице, включая в модалке (от одних и тех же скриптов JS/PHP и от разных).</p>
		<p>Код современный, лаконичный, поддерживаемый всеми современными браузерами с возрастом до 2 лет (IE не надо).</p>
		<p>Желательно встроить в скрипт простые и полезные функции безопасности, например инпут-приманка, может есть еще что-то?</p>
		<br><hr><br>


		<h2>Дополнительные требования</h2>
		<p>Формы на всех этапах должны быть доступными на достаточно высоком уровне.</p>
		<p>Желательно добавить функционал отправки сообщений в телеграм, ватсапп.</p>
		<br><hr><br>




		<h2>Подробнее что сделать в JS-скрипте</h2>

		<h3>Скрипт для инпута-приманки</h3>
		<p>Что отправка работала и с приманкой и без приманки, а когда приманка заполнена, то письмо чтобы не отправлялось. Чтобы можно было просто добавлять или удалять в форме этот инпут, а в скрипте чтобы можно было легко удалить этот участок кода. На бэкенде ваш скрипт обработки может проверить, заполнено ли поле-приманка. Если это так, то отправка, вероятно, была от бота, и можно ее проигнорировать.</p>
		<pre><code>&lt;label class="honeypot" for="honeypot" style="display: none;" aria-hidden="true" hidden&gt;Оставьте это поле пустым&lt;/label&gt;<br>&lt;input class="honeypot" id="honeypot" style="display: none;" type="text" autocomplete="off" tabindex="-1" aria-hidden="true" hidden&gt;</code></pre>
		<hr>


		<h3>Сообщение об успехе/неудаче отправки</h3>
		<p>- После успешной отправки сообщения скрипт должен показать пользователю что сообщение отправлено и очистить форму. Не знаю какое тут лучшее решение. Сейчас в HTML добавляю:<br>
		<code>&lt;p class="form-success"&gt;Сообщение отправлено.&lt;/p&gt;</code><br>
		<code>&lt;p class="form-failure"&gt;Сообщение не отправлено!&lt;/p&gt;</code><br>
		И скрипт должен добавить к этим элементам класс ".active" чтобы они появились.
		Как вариант можно скрыть кнопку отправки и на ее месте показать сообщение об успехе, тогда макет не будет сдвигаться (но надо продумать хорошо ли это, как будет доступность?).
		</p>
		<br><hr><br>


		<h3>Скрипт для отправки файлов внедрить в общий скрипт отправки</h3>
		<p>Чтобы он работал когда есть поле отправки и не мешал когда его нет. Чтобы имел базовую валидацию отправляемых файлов: максимальный размер, форматы файлов, количество файлов? Или валидацию лучше делать в PHP-скрипте?</p>
		<br><hr><hr><hr><br>


		<section style="color: rgb(176, 0, 0);">
			<h2>Текущие проблемы с компонентом</h2>
			<br><hr><br>


			<h3>Проблемы с PHP-файлом</h3>
			<p>В PHP-файле есть лишний код: в блоке формирования письма прописано условие, там $key сравнивается с project_name, admin_email и form_subject. Автор говорит что это код со старого скрипта и это условие можно удалить.</p>
			<br>

			<p>Отправка формы-1 (без JS) и формы-2 (с JS) приводит к одинаковому результату: письмо нормально пришло, но страница перенаправляется на <code>https://mitorun.studio/fls/phpmailer/mail-1.php</code> и нет никаких подтверждений успешной отправки.</p>
			<p>При этом загрузка файлов не работает: открывается страница <code>https://mitorun.studio/fls/phpmailer/mail-exp.php</code> с ошибкой <code>Fatal error: Uncaught TypeError: count(): Argument #1 ($value) must be of type Countable|array, string given in /var/www/u0867248/data/www/mitorun.studio/fls/phpmailer/mail-exp.php:54 Stack trace: #0 {main} thrown in /var/www/u0867248/data/www/mitorun.studio/fls/phpmailer/mail-exp.php on line 54</code>.
			</p>



			<h3>Проблемы с JS-скриптом</h3>

		</section>




	</main>


	<div style="height: 100vh;"></div>


</body>
</html>
